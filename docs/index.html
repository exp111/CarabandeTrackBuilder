<!DOCTYPE html>
<html>
<head>
    <title>Carabande</title>
    <script src="js/include/konva.min.js"></script>
</head>
<body>
<div id="debug">
    <input id="forceShowSnapzones" type="checkbox" value="false" onchange="forceShowSnapzones(this.checked)">
    <label for="forceShowSnapzones">Show Snapzones</label>
    <button onclick="serializeTrack()">Serialize</button>
</div>
<div id="menu">
    <input id="disableSnapping" type="checkbox" value="false" onchange="disableSnapping(this.checked)">
    <label for="disableSnapping">Disable Snapping</label>
    <select id="tracks" onchange="onTrackChange(this.value)">
        <option value="" disabled selected hidden>Preset Tracks</option>
    </select>
    <button onclick="clearButton()">Clear</button>
    <button onclick="randomTrack()">Random</button>
    <label for="randomMin">Min Tiles</label>
    <!--You can not have a track with an odd number of tiles-->
    <input id="randomMin" type="number" value="6" min="6" max="30" step="2" onchange="randomMinMaxChange(this)">
    <label for="randomMax">Max Tiles</label>
    <input id="randomMax" type="number" value="10" min="6" max="30" step="2" onchange="randomMinMaxChange(this)">
</div>
<div id="canvas"></div>
</body>
<script src="js/vector.js"></script>
<script src="js/canvas.js"></script>
<script src="js/trackbuilder.js"></script>
<script>
    const Global = {
        forceShowSnapzones: false,
        disableSnapping: false,
        IsDebug: window.location.protocol == "file:" || window.location.hostname == "localhost",
        trackbuilder: new Trackbuilder(tracks),
    }
    debug.hidden = !Global.IsDebug;
    Global.forceShowSnapzones = Global.IsDebug;

    function forceShowSnapzones(val) {
        Global.forceShowSnapzones = val;
        toggleSnapzones(val);
    }

    function serializeTrack() {
        let track = Global.trackbuilder.serializeTrack();
        console.log(track);
        console.log(JSON.stringify(track));
    }

    function disableSnapping(val) {
        Global.disableSnapping = val;
    }

    function onTrackChange(val) {
        clearTracks();
        Global.trackbuilder.onTrackSelect(val);
    }

    function clearButton() {
        tracks.selectedIndex = 0;
        clearTracks();
    }

    function randomTrack() {
        clearTracks();
        let min = Number(randomMin.value);
        let cap = Number(randomMax.value);
        Global.trackbuilder.random(min, cap);
    }

    function randomMinMaxChange(el) {
        // keeps min <= max and max >= min
        if (el == randomMin) {
            randomMax.value = Math.max(el.value, randomMax.value);
        } else if (el == randomMax) {
            randomMin.value = Math.min(randomMin.value, el.value);
        }
    }

    createCanvas();
    initPresets();
</script>
</html>